{% extends "base.html" %}

{% block title %}Student Dashboard - Smart Hostel System{% endblock %}

{% block content %}
<h2>Welcome, {{ current_user.full_name }}!</h2>
<p><strong>Registered on:</strong> {{ current_user.created_at.strftime('%Y-%m-%d %H:%M') }}</p>

<div class="dashboard-grid">
    <div class="dashboard-card">
        <h3><i class="fas fa-file-alt"></i> Application Status</h3>
        {% if application %}
            <p><strong>Status:</strong> <span class="status-{{ application.status }}">{{ application.status|title }}</span></p>
            <p><strong>Applied:</strong> {{ application.applied_at.strftime('%Y-%m-%d') }}</p>
            {% if application.admin_notes %}
                <p><strong>Admin Notes:</strong> {{ application.admin_notes }}</p>
            {% endif %}
        {% else %}
            <p>No application submitted yet.</p>
            <a href="{{ url_for('apply_for_room') }}" class="btn btn-primary"><i class="fas fa-plus-circle"></i> Apply for Room</a>
        {% endif %}
    </div>

    <div class="dashboard-card">
        <h3><i class="fas fa-key"></i> Room Allocation</h3>
        {% if allocation %}
            {% if allocation.status == 'checked_out' %}
                <div class="alert alert-info">
                    <p><strong>Status:</strong> <span class="status-checked_out">Checked Out</span></p>
                    <p><strong>Check-out Date:</strong> {{ allocation.check_out_date.strftime('%Y-%m-%d') if allocation.check_out_date else 'N/A' }}</p>
                    {% if allocation.checkout_reason %}
                    <p><strong>Reason:</strong> {{ allocation.checkout_reason }}</p>
                    {% endif %}
                </div>
            {% else %}
                <p><strong>Room:</strong> {{ allocation.room.block.name }} ({{ allocation.room.block.gender|title }}) - Floor {{ allocation.room.floor }} - Room {{ allocation.room.room_number }}</p>
                <p><strong>Room Type:</strong> {{ allocation.room.room_type or 'N/A' }}</p>
                <p><strong>Allocated:</strong> {{ allocation.allocated_at.strftime('%Y-%m-%d') }}</p>
                {% if allocation.check_in_date %}
                <p><strong>Check-in Date:</strong> {{ allocation.check_in_date.strftime('%Y-%m-%d') }}</p>
                {% endif %}
            {% endif %}
        {% else %}
            <p>No room allocated yet.</p>
        {% endif %}
    </div>

    <div class="dashboard-card">
        <h3><i class="fas fa-exclamation-circle"></i> Recent Complaints</h3>
        {% if complaints %}
            <ul class="complaint-list">
                {% for complaint in complaints %}
                <li>
                    <strong>{{ complaint.title }}</strong> - 
                    <span class="status-{{ complaint.status }}">{{ complaint.status|title }}</span>
                </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No complaints submitted.</p>
        {% endif %}
        <a href="{{ url_for('complaints') }}" class="btn btn-secondary">View All</a>
    </div>

    <div class="dashboard-card">
        <h3><i class="fas fa-money-bill-wave"></i> Pending Fees</h3>
        {% if pending_fees %}
            <ul>
                {% for fee in pending_fees %}
                <li>{{ fee.fee_type|title }}: Rs{{ fee.amount }} (Due: {{ fee.due_date.strftime('%Y-%m-%d') }})</li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No pending fees.</p>
        {% endif %}
        <a href="{{ url_for('student_fees') }}" class="btn btn-secondary">View All</a>
    </div>
</div>

<div class="quick-actions">
        <a href="{{ url_for('apply_for_room') }}" class="btn btn-primary"><i class="fas fa-plus-circle"></i> Apply for Room</a>
        <a href="{{ url_for('view_rooms') }}" class="btn btn-secondary"><i class="fas fa-search"></i> View Available Rooms</a>
        <a href="{{ url_for('complaints') }}" class="btn btn-secondary"><i class="fas fa-comment-dots"></i> Submit Complaint</a>
</div>
{% endblock %}

